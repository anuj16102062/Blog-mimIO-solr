/**
 * Modules dependencies
 */
var solr = require('../main'),
	http = require('http');

http.globalAgent.maxSockets = 10;

var t = process.hrtime();

var client = solr.createClient({host : '192.168.1.73'});
var query = client.createQuery()
				.q('*:*');

var n = 10;
function again(){
	n--;
	if(n !== 0){
		tonsOfSearch(again);
	}else{
		var tt = process.hrtime(t);
	  	console.log('benchmark took %d seconds and %d nanoseconds', tt[0], tt[1]);
	  	var average = (tt[0] * 1000000000 + tt[1]) / 1000000000 / 10 ;
	  	console.log('Average: 10000 executed within %d seconds',average);
	}
}
tonsOfSearch(again);

function tonsOfSearch(done){
	var ths = process.hrtime();
	var j = 0;
	for(var i = 0; i <= 100; i++){
		client.search(query,function(err,obj){
			if(err) console.log(err)
			//if(!err) console.log(obj)
			j++;
			if(j === 100){
				var th = process.hrtime(ths);
	  			console.log('benchmark took %d seconds and %d nanoseconds', th[0], th[1]);
	  			done();
	  		}
		});
	}
}

setInterval(function(){
	if(http.globalAgent.sockets['192.168.1.73:8983']) {
		console.log(http.globalAgent.sockets['192.168.1.73:8983'])
		console.log('Numbers of sockets in used %d',http.globalAgent.sockets['192.168.1.73:8983'].length);
	}else{
		clearInterval();
	}
},100);

